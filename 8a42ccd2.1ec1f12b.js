/*! For license information please see 8a42ccd2.1ec1f12b.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[59],{160:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return c})),n.d(t,"metadata",(function(){return i})),n.d(t,"rightToc",(function(){return l})),n.d(t,"default",(function(){return p}));var r=n(1),o=n(6),a=(n(225),n(224)),c={id:"keycloak",title:"Out of the box Keycloak based authentication",sidebar_label:"Keycloak Auth"},i={id:"authentication/keycloak",isDocsHomePage:!1,title:"Out of the box Keycloak based authentication",description:"Graphback Keycloak Authz",source:"@site/../docs/authentication/keycloak.md",permalink:"/docs/next/authentication/keycloak",editUrl:"https://github.com/aerogear/graphback/edit/master/website/../docs/authentication/keycloak.md",version:"next",sidebar_label:"Keycloak Auth",sidebar:"docs",previous:{title:"Authentication and authorization for Graphback",permalink:"/docs/next/authentication/authinto"},next:{title:"Live Updates for Graphback",permalink:"/docs/next/subscriptions/subintro"},latestVersionMainDocPermalink:"/docs/gettingstarted"},l=[{value:"Graphback Keycloak Authz",id:"graphback-keycloak-authz",children:[]},{value:"Getting Started",id:"getting-started",children:[]},{value:"Example with Graphback Runtime",id:"example-with-graphback-runtime",children:[]}],u={rightToc:l};function p(e){var t=e.components,n=Object(o.a)(e,["components"]);return Object(a.b)("wrapper",Object(r.a)({},u,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("h2",{id:"graphback-keycloak-authz"},"Graphback Keycloak Authz"),Object(a.b)("p",null,"Graphback Keycloak Authz enables ",Object(a.b)("a",Object(r.a)({parentName:"p"},{href:"https://www.keycloak.org/"}),"Keycloak")," integration in ",Object(a.b)("a",Object(r.a)({parentName:"p"},{href:"https://graphback.dev"}),"Graphback")," based applications. This enables you to declaratively add authorization capabilities like role based access on top of the CRUD model that is used within Graphback."),Object(a.b)("p",null,"This package is designed to work with ",Object(a.b)("a",Object(r.a)({parentName:"p"},{href:"https://www.npmjs.com/package/keycloak-connect"}),Object(a.b)("inlineCode",{parentName:"a"},"keycloak-connect"))," and ",Object(a.b)("a",Object(r.a)({parentName:"p"},{href:"https://www.npmjs.com/package/keycloak-connect-graphql"}),Object(a.b)("inlineCode",{parentName:"a"},"keycloak-connect-graphql")),". ",Object(a.b)("inlineCode",{parentName:"p"},"keycloak-connect")," is the official Keycloak middleware for Express applications. ",Object(a.b)("inlineCode",{parentName:"p"},"keycloak-connect-graphql")," provides deeper Keycloak integration into GraphQL servers."),Object(a.b)("blockquote",null,Object(a.b)("p",{parentName:"blockquote"},"NOTE: This package is an early alpha and not officially supported by Graphback")),Object(a.b)("h2",{id:"getting-started"},"Getting Started"),Object(a.b)("p",null,"This module requires you to install the following dependencies into your application."),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{className:"language-bash"}),"npm install keycloak-connect\nnpm install keycloak-connect-graphql\n")),Object(a.b)("p",null,"Then follow the ",Object(a.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/aerogear/keycloak-connect-graphql#getting-started"}),"Getting started instructions for ",Object(a.b)("inlineCode",{parentName:"a"},"keycloak-connect-graphql"))),Object(a.b)("p",null,"Once the getting started instructions are covered, you must create a configuration that defines the authorization rules for each model within your Graphback application."),Object(a.b)("p",null,"Here is an example configuration."),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{className:"language-ts"}),"const authConfig = {\n  Task: {\n    create: {},\n    read: {},\n    update: { roles: ['admin'] },\n    delete: { roles: ['admin'] },\n  },\n  Report: {\n    create: { roles: ['admin'] },\n    read: {},\n    update: { roles: ['admin'] },\n    delete: { roles: ['admin'] },\n  },\n};\n")),Object(a.b)("p",null,"With this configuration the following rules are in place."),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"All users can create and read ",Object(a.b)("inlineCode",{parentName:"li"},"Task")," types but only admins can update and delete them."),Object(a.b)("li",{parentName:"ul"},"Admin users can create, update and delete ",Object(a.b)("inlineCode",{parentName:"li"},"Report")," types, and all users can read them.")),Object(a.b)("h2",{id:"example-with-graphback-runtime"},"Example with Graphback Runtime"),Object(a.b)("p",null,"During server initialization, use the ",Object(a.b)("inlineCode",{parentName:"p"},"createKeycloakCRUDService")," function to initialize the KeycloakCrudService instances for each model."),Object(a.b)("p",null,"The following example shows just the necessary parts to set up the runtime services in Graphback."),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{className:"language-ts"}),"import { ApolloServer } from 'apollo-server-express'\nimport { createKeycloakCRUDService } from '@graphback/keycloak-authz'\nimport { KnexDbDataProvider } from '@graphback/runtime-knex'\nimport { PubSub } from 'graphql-subscriptions'\nimport * as Knex from 'knex'\nimport { buildGraphbackAPI, createCRUDService } from 'graphback'\n\n// the application model\nconst model = `\n\"\"\"\n@model\n\"\"\"\ntype Task {\n  id: ID!\n  title: String!\n  description: String!\n}`\n\n// the auth rules for the application\nconst authConfig = {\n  Task: {\n    create: {},\n    read: {},\n    update: { roles: [\"admin\"] },\n    delete: { roles: [\"admin\"] }\n  }\n}\n\n// set up the Knex database client\nconst db = Knex({...})\n\n// standard Graphback runtime setup\nconst pubSub = new PubSub()\n\nconst keycloakService = createKeycloakCRUDService(authConfig, createCRUDService({\n  pubSub: new PubSub()\n}));\nconst { typeDefs, resolvers, contextCreator } = buildGraphbackAPI(modelDefs, {\n  serviceCreator: keycloakService,\n  dataProviderCreator: createKnexDbProvider(db)\n});\n\nconst server = new ApolloServer({\n  typeDefs,\n  resolvers,\n  context: (context) => {\n    return {\n      ...contextCreator(context),\n      kauth: new KeycloakContext({ req: context.req })\n    }\n  }\n})\n")),Object(a.b)("p",null,"The above example shows runtime set up using the KnexDbDataProvider, but other data providers such as the ",Object(a.b)("inlineCode",{parentName:"p"},"MongoDBDataProvider")," can also be passed."))}p.isMDXComponent=!0},224:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return d}));var r=n(0),o=n.n(r);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var u=o.a.createContext({}),p=function(e){var t=o.a.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):i({},t,{},e)),n},s=function(e){var t=p(e.components);return o.a.createElement(u.Provider,{value:t},e.children)},f={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},b=Object(r.forwardRef)((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,c=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),s=p(n),b=r,d=s["".concat(c,".").concat(b)]||s[b]||f[b]||a;return n?o.a.createElement(d,i({ref:t},u,{components:n})):o.a.createElement(d,i({ref:t},u))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,c=new Array(a);c[0]=b;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:r,c[1]=i;for(var u=2;u<a;u++)c[u]=n[u];return o.a.createElement.apply(null,c)}return o.a.createElement.apply(null,n)}b.displayName="MDXCreateElement"},225:function(e,t,n){"use strict";e.exports=n(226)},226:function(e,t,n){"use strict";var r=n(227),o="function"==typeof Symbol&&Symbol.for,a=o?Symbol.for("react.element"):60103,c=o?Symbol.for("react.portal"):60106,i=o?Symbol.for("react.fragment"):60107,l=o?Symbol.for("react.strict_mode"):60108,u=o?Symbol.for("react.profiler"):60114,p=o?Symbol.for("react.provider"):60109,s=o?Symbol.for("react.context"):60110,f=o?Symbol.for("react.forward_ref"):60112,b=o?Symbol.for("react.suspense"):60113,d=o?Symbol.for("react.memo"):60115,h=o?Symbol.for("react.lazy"):60116,y="function"==typeof Symbol&&Symbol.iterator;function m(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var k={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g={};function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||k}function O(){}function j(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||k}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error(m(85));this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},O.prototype=v.prototype;var w=j.prototype=new O;w.constructor=j,r(w,v.prototype),w.isPureReactComponent=!0;var x={current:null},S=Object.prototype.hasOwnProperty,C={key:!0,ref:!0,__self:!0,__source:!0};function P(e,t,n){var r,o={},c=null,i=null;if(null!=t)for(r in void 0!==t.ref&&(i=t.ref),void 0!==t.key&&(c=""+t.key),t)S.call(t,r)&&!C.hasOwnProperty(r)&&(o[r]=t[r]);var l=arguments.length-2;if(1===l)o.children=n;else if(1<l){for(var u=Array(l),p=0;p<l;p++)u[p]=arguments[p+2];o.children=u}if(e&&e.defaultProps)for(r in l=e.defaultProps)void 0===o[r]&&(o[r]=l[r]);return{$$typeof:a,type:e,key:c,ref:i,props:o,_owner:x.current}}function E(e){return"object"==typeof e&&null!==e&&e.$$typeof===a}var _=/\/+/g,N=[];function D(e,t,n,r){if(N.length){var o=N.pop();return o.result=e,o.keyPrefix=t,o.func=n,o.context=r,o.count=0,o}return{result:e,keyPrefix:t,func:n,context:r,count:0}}function R(e){e.result=null,e.keyPrefix=null,e.func=null,e.context=null,e.count=0,10>N.length&&N.push(e)}function T(e,t,n){return null==e?0:function e(t,n,r,o){var i=typeof t;"undefined"!==i&&"boolean"!==i||(t=null);var l=!1;if(null===t)l=!0;else switch(i){case"string":case"number":l=!0;break;case"object":switch(t.$$typeof){case a:case c:l=!0}}if(l)return r(o,t,""===n?"."+A(t,0):n),1;if(l=0,n=""===n?".":n+":",Array.isArray(t))for(var u=0;u<t.length;u++){var p=n+A(i=t[u],u);l+=e(i,p,r,o)}else if(null===t||"object"!=typeof t?p=null:p="function"==typeof(p=y&&t[y]||t["@@iterator"])?p:null,"function"==typeof p)for(t=p.call(t),u=0;!(i=t.next()).done;)l+=e(i=i.value,p=n+A(i,u++),r,o);else if("object"===i)throw r=""+t,Error(m(31,"[object Object]"===r?"object with keys {"+Object.keys(t).join(", ")+"}":r,""));return l}(e,"",t,n)}function A(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+(""+e).replace(/[=:]/g,(function(e){return t[e]}))}(e.key):t.toString(36)}function $(e,t){e.func.call(e.context,t,e.count++)}function K(e,t,n){var r=e.result,o=e.keyPrefix;e=e.func.call(e.context,t,e.count++),Array.isArray(e)?G(e,r,n,(function(e){return e})):null!=e&&(E(e)&&(e=function(e,t){return{$$typeof:a,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(e,o+(!e.key||t&&t.key===e.key?"":(""+e.key).replace(_,"$&/")+"/")+n)),r.push(e))}function G(e,t,n,r,o){var a="";null!=n&&(a=(""+n).replace(_,"$&/")+"/"),T(e,K,t=D(t,a,r,o)),R(t)}var q={current:null};function U(){var e=q.current;if(null===e)throw Error(m(321));return e}var z={ReactCurrentDispatcher:q,ReactCurrentBatchConfig:{suspense:null},ReactCurrentOwner:x,IsSomeRendererActing:{current:!1},assign:r};t.Children={map:function(e,t,n){if(null==e)return e;var r=[];return G(e,r,null,t,n),r},forEach:function(e,t,n){if(null==e)return e;T(e,$,t=D(null,null,t,n)),R(t)},count:function(e){return T(e,(function(){return null}),null)},toArray:function(e){var t=[];return G(e,t,null,(function(e){return e})),t},only:function(e){if(!E(e))throw Error(m(143));return e}},t.Component=v,t.Fragment=i,t.Profiler=u,t.PureComponent=j,t.StrictMode=l,t.Suspense=b,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=z,t.cloneElement=function(e,t,n){if(null==e)throw Error(m(267,e));var o=r({},e.props),c=e.key,i=e.ref,l=e._owner;if(null!=t){if(void 0!==t.ref&&(i=t.ref,l=x.current),void 0!==t.key&&(c=""+t.key),e.type&&e.type.defaultProps)var u=e.type.defaultProps;for(p in t)S.call(t,p)&&!C.hasOwnProperty(p)&&(o[p]=void 0===t[p]&&void 0!==u?u[p]:t[p])}var p=arguments.length-2;if(1===p)o.children=n;else if(1<p){u=Array(p);for(var s=0;s<p;s++)u[s]=arguments[s+2];o.children=u}return{$$typeof:a,type:e.type,key:c,ref:i,props:o,_owner:l}},t.createContext=function(e,t){return void 0===t&&(t=null),(e={$$typeof:s,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:p,_context:e},e.Consumer=e},t.createElement=P,t.createFactory=function(e){var t=P.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:f,render:e}},t.isValidElement=E,t.lazy=function(e){return{$$typeof:h,_ctor:e,_status:-1,_result:null}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.useCallback=function(e,t){return U().useCallback(e,t)},t.useContext=function(e,t){return U().useContext(e,t)},t.useDebugValue=function(){},t.useEffect=function(e,t){return U().useEffect(e,t)},t.useImperativeHandle=function(e,t,n){return U().useImperativeHandle(e,t,n)},t.useLayoutEffect=function(e,t){return U().useLayoutEffect(e,t)},t.useMemo=function(e,t){return U().useMemo(e,t)},t.useReducer=function(e,t,n){return U().useReducer(e,t,n)},t.useRef=function(e){return U().useRef(e)},t.useState=function(e){return U().useState(e)},t.version="16.13.1"},227:function(e,t,n){"use strict";var r=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable;function c(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(o){return!1}}()?Object.assign:function(e,t){for(var n,i,l=c(e),u=1;u<arguments.length;u++){for(var p in n=Object(arguments[u]))o.call(n,p)&&(l[p]=n[p]);if(r){i=r(n);for(var s=0;s<i.length;s++)a.call(n,i[s])&&(l[i[s]]=n[i[s]])}}return l}}}]);