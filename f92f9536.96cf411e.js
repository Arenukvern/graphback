(window.webpackJsonp=window.webpackJsonp||[]).push([[174],{312:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return l})),n.d(t,"rightToc",(function(){return s})),n.d(t,"default",(function(){return c}));var r=n(2),a=n(9),o=(n(0),n(322)),i={id:"filters",title:"GraphQL Migrations Filters",sidebar_label:"Operation Filter"},l={id:"graphql-migrations/filters",isDocsHomePage:!1,title:"GraphQL Migrations Filters",description:"It is possible to write custom hooks that can be used to filter out undesirable database operations such as those that could lead to data loss from being executed. The filter is an interface defining a function that takes take the operation and returns true to execute the operation and false otherwise. By default, GraphQL Migrations does not apply any filter.",source:"@site/../docs/graphql-migrations/operation-filters.md",permalink:"/docs/next/graphql-migrations/filters",editUrl:"https://github.com/aerogear/graphback/edit/master/website/../docs/graphql-migrations/operation-filters.md",version:"next",sidebar_label:"Operation Filter",sidebar:"docs",previous:{title:"Custom logic with Plugins",permalink:"/docs/next/graphql-migrations/plugins"},next:{title:"Running an API without code",permalink:"/docs/next/graphqlserve/graphqlserve"},latestVersionMainDocPermalink:"/docs/introduction"},s=[],p={rightToc:s};function c(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(o.b)("wrapper",Object(r.a)({},p,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"It is possible to write custom hooks that can be used to filter out undesirable database operations such as those that could lead to data loss from being executed. The filter is an interface defining a function that takes take the operation and returns ",Object(o.b)("inlineCode",{parentName:"p"},"true")," to execute the operation and false otherwise. By default, GraphQL Migrations does not apply any filter. "),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-ts"}),"export interface MigrateOperationFilter {\n  filter(operations: Operation[]): Operation[];\n};\n")),Object(o.b)("p",null,"For example, if we want to prevent deletion of the tables and columns we can write the following filter to remove ",Object(o.b)("inlineCode",{parentName:"p"},"table.drop")," and ",Object(o.b)("inlineCode",{parentName:"p"},"column.drop")," operations from array:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-ts"}),"/**\n * Suppress table and column deletion operations that are not going to cause data loss when field was removed accidentially.\n */\nexport const removeDeletionOperations: MigrateOperationFilter = {\n  filter: (operations: Operation[]) => {\n    return operations.filter((op: Operation) => op.type !== 'table.drop' && op.type !== 'column.drop'\n  }\n};\n")),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"removeDeletionOperations")," filter can then be used in the ",Object(o.b)("inlineCode",{parentName:"p"},"migrateDB")," method as follows:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-ts"}),"....\n\nmigrateDB(dbConfig, schema, {\n  operationFilter: removeDeletionOperations\n})\n\n....\n")),Object(o.b)("p",null,"GraphQL Migrations has you covered and provides a ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/aerogear/graphback/blob/master/packages/graphql-migrations/src/plugin/MigrateOperationFilter.ts"}),Object(o.b)("inlineCode",{parentName:"a"},"removeNonSafeOperationsFilter"))," to avoid doing non safe operations such as table deletion and renaming. "))}c.isMDXComponent=!0},322:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return f}));var r=n(0),a=n.n(r);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=a.a.createContext({}),c=function(e){var t=a.a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=c(e.components);return a.a.createElement(p.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},b=a.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=c(n),b=r,f=u["".concat(i,".").concat(b)]||u[b]||d[b]||o;return n?a.a.createElement(f,l(l({ref:t},p),{},{components:n})):a.a.createElement(f,l({ref:t},p))}));function f(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=b;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var p=2;p<o;p++)i[p]=n[p];return a.a.createElement.apply(null,i)}return a.a.createElement.apply(null,n)}b.displayName="MDXCreateElement"}}]);